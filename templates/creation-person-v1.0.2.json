{
  "id": "S3qSs9eaXB2gwdtfVD23i",
  "name": "Creation Person",
  "description": "",
  "tags": [],
  "pieces": [
    "@activepieces/piece-http",
    "@activepieces/piece-postgres",
    "@tuyendaovan6789/piece-pipedrive"
  ],
  "pinnedOrder": null,
  "blogUrl": "",
  "template": {
    "displayName": "Creation Person",
    "trigger": {
      "name": "trigger",
      "valid": true,
      "displayName": "webhook trigger upsert user_profiles",
      "nextAction": {
        "name": "step_1",
        "type": "CODE",
        "valid": true,
        "settings": {
          "input": {
            "body": "{{trigger['body']}}"
          },
          "inputUiInfo": {},
          "artifact": "UEsDBAoAAAAAAEKBMlfL6P4yTwAAAE8AAAAIAAAAaW5kZXgudHNleHBvcnQgY29uc3QgY29kZSA9IGFzeW5jIChpbnB1dHMpID0+IHsKICAgIHJldHVybiBKU09OLnBhcnNlKGlucHV0cy5ib2R5KTsKfTsKUEsDBAoAAAAAAEKBMlcaUtEIHAAAABwAAAAMAAAAcGFja2FnZS5qc29uewogICJkZXBlbmRlbmNpZXMiOiB7CiAgfQp9ClBLAQIUAAoAAAAAAEKBMlfL6P4yTwAAAE8AAAAIAAAAAAAAAAAAAAAAAAAAAABpbmRleC50c1BLAQIUAAoAAAAAAEKBMlcaUtEIHAAAABwAAAAMAAAAAAAAAAAAAAAAAHUAAABwYWNrYWdlLmpzb25QSwUGAAAAAAIAAgBwAAAAuwAAAAAA"
        },
        "nextAction": {
          "name": "step_13",
          "type": "BRANCH",
          "valid": true,
          "settings": {
            "conditions": [
              [
                {
                  "operator": "TEXT_DOES_NOT_CONTAIN",
                  "firstValue": "{{step_1['__op']}}",
                  "secondValue": "d",
                  "caseSensitive": false
                }
              ]
            ],
            "inputUiInfo": {}
          },
          "displayName": "is not delete action",
          "onSuccessAction": {
            "name": "step_2",
            "type": "PIECE",
            "valid": true,
            "settings": {
              "input": {
                "url": "https://api.pipedrive.com/v1/persons/search",
                "method": "GET",
                "headers": {
                  "Accept": "application/json"
                },
                "timeout": "30",
                "failsafe": false,
                "queryParams": {
                  "term": "{{step_1['email']}}",
                  "limit": "10",
                  "start": "0",
                  "fields": "email",
                  "api_token": "9bca12a3180d496067d542057a8c88d907c18c04",
                  "exact_match": "true"
                }
              },
              "pieceName": "@activepieces/piece-http",
              "actionName": "send_request",
              "inputUiInfo": {},
              "pieceVersion": "0.3.5"
            },
            "nextAction": {
              "name": "step_3",
              "type": "CODE",
              "valid": true,
              "settings": {
                "input": {
                  "items": "{{step_2['body']['data']['items']}}"
                },
                "inputUiInfo": {},
                "artifact": "UEsDBAoAAAAAAGCBMleQpNihSgAAAEoAAAAIAAAAaW5kZXgudHNleHBvcnQgY29uc3QgY29kZSA9IGFzeW5jIChpbnB1dHMpID0+IHsKICAgIHJldHVybiBpbnB1dHMuaXRlbXMubGVuZ3RoOwp9O1BLAwQKAAAAAABggTJXGlLRCBwAAAAcAAAADAAAAHBhY2thZ2UuanNvbnsKICAiZGVwZW5kZW5jaWVzIjogewogIH0KfQpQSwECFAAKAAAAAABggTJXkKTYoUoAAABKAAAACAAAAAAAAAAAAAAAAAAAAAAAaW5kZXgudHNQSwECFAAKAAAAAABggTJXGlLRCBwAAAAcAAAADAAAAAAAAAAAAAAAAABwAAAAcGFja2FnZS5qc29uUEsFBgAAAAACAAIAcAAAALYAAAAAAA=="
              },
              "nextAction": {
                "name": "step_4",
                "type": "BRANCH",
                "valid": true,
                "settings": {
                  "conditions": [
                    [
                      {
                        "operator": "NUMBER_IS_GREATER_THAN",
                        "firstValue": "{{step_3}}",
                        "secondValue": "0"
                      }
                    ]
                  ],
                  "inputUiInfo": {}
                },
                "displayName": "is exists person",
                "onFailureAction": {
                  "name": "step_10",
                  "type": "PIECE",
                  "valid": true,
                  "settings": {
                    "input": {
                      "auth": "{{connections['ic-postgres']}}",
                      "query": "SELECT\n    name\nFROM user_management.countries\nwhere code = '{{step_1['country_code']}}' AND sharding_id = '00000000-9999-9999-9999-999999999999'\nLIMIT 1;",
                      "query_timeout": "30000",
                      "application_name": "activepieces - creation person",
                      "connection_timeout_ms": "30000"
                    },
                    "pieceName": "@activepieces/piece-postgres",
                    "actionName": "run-query",
                    "inputUiInfo": {},
                    "pieceVersion": "0.1.0"
                  },
                  "nextAction": {
                    "name": "step_12",
                    "type": "CODE",
                    "valid": true,
                    "settings": {
                      "input": {
                        "person": "{{step_1}}",
                        "country_name": "{{step_10[0]['name']}}"
                      },
                      "inputUiInfo": {},
                      "artifact": "UEsDBAoAAAAAALmAMlf7XA6/GAUAABgFAAAIAAAAaW5kZXgudHNleHBvcnQgY29uc3QgY29kZSA9IGFzeW5jIChpbnB1dHMpID0+IHsKICAgIGxldCBlbWFpbCA9IFt7dmFsdWU6IGlucHV0cy5wZXJzb24uZW1haWx9XTsKICAgIGxldCBwaG9uZSA9IFt7dmFsdWU6IGlucHV0cy5wZXJzb24ucGhvbmVfbnVtYmVyfV07CiAgICBsZXQgZmlyc3RfbmFtZSA9IGlucHV0cy5wZXJzb24uZnVsbF9uYW1lLnNwbGl0KCcgJykuc2xpY2UoMCwgLTEpLmpvaW4oJyAnKTsKICAgIGxldCBsYXN0X25hbWUgPSBpbnB1dHMucGVyc29uLmZ1bGxfbmFtZS5zcGxpdCgnICcpLnNsaWNlKC0xKS5qb2luKCcgJyk7CiAgICBsZXQgYWNjb3VudF90eXBlID0gaW5wdXRzLnBlcnNvbi5hY2NvdW50X3R5cGUgPT0gMSA/ICIyNzIiIDogaW5wdXRzLnBlcnNvbi5hY2NvdW50X3R5cGUgPT0gMiA/ICIyNzEiIDogbnVsbDsKICAgIGxldCBnZW5kZXIgPSBpbnB1dHMucGVyc29uLmdlbmRlciA9PSAxID8gIjI3NCIgOiBpbnB1dHMucGVyc29uLmdlbmRlciA9PSAyID8gIjI3MyIgOiBpbnB1dHMucGVyc29uLmdlbmRlciA9PSAzID8gIjI3NSIgOiBudWxsOwogICAgbGV0IGJpcnRoX2RheSA9IGlucHV0cy5wZXJzb24uYmlydGhfZGF5ICE9IG51bGwgPyBuZXcgRGF0ZShpbnB1dHMucGVyc29uLmJpcnRoX2RheSkgOiBudWxsOwoKICAgIHJldHVybiB7CiAgICAgICAgIm5hbWUiOiBpbnB1dHMucGVyc29uLmZ1bGxfbmFtZSwKICAgICAgICAiZmlyc3RfbmFtZSI6IGZpcnN0X25hbWUsCiAgICAgICAgImxhc3RfbmFtZSI6IGxhc3RfbmFtZSwKICAgICAgICAiZW1haWwiOiBlbWFpbCwKICAgICAgICAicGhvbmUiOiBwaG9uZSwKICAgICAgICAiZmFhY2JjNzRhZmYyNWNhNmU4NTIxZDMwOTVlNTUwYzJlMzIzY2I3NyI6IGJpcnRoX2RheSwKICAgICAgICAiNGU1OGI2MjM5ZDM4ZmJiYzUyNjBkNWY1NTU4N2E4YTRkNDg2YzRiNCI6IGdlbmRlciwKICAgICAgICAiM2ZhMDJlODI4NjdjNTIxODEwZWMwODQyN2I3MzgxMTY0YzZjMmVhNiI6IGlucHV0cy5wZXJzb24uZmFjZWJvb2tfbGluaywKICAgICAgICAiNWViYWVhYzU5YWEzMDQyZGE5MzY0Y2M3ODljYTc3NWVmZTUyNDFlMyI6IGlucHV0cy5wZXJzb24uemFsb19saW5rLAogICAgICAgICJjNmU4OGJhOTc0ODM5MDJjNjZlZDQ4ZjY4NDQxYTM5YThiMzMwNWIzX2NvdW50cnkiOiBpbnB1dHMuY291bnRyeV9uYW1lLAogICAgICAgICJiOWFmODRkZjVlOGU0MGFlMjE1ODdiOGYxZmExN2MyMmJhZjQ0MWIwIjogYWNjb3VudF90eXBlLAogICAgICAgICJkZjE3ZGIyMmQ5NDA5NjBiNDNiYTNmMzBiNGQzOWUwZjJlMmJkZmYwIjogIk9yZyIKICAgIH07Cn07ClBLAwQKAAAAAAC5gDJXGlLRCBwAAAAcAAAADAAAAHBhY2thZ2UuanNvbnsKICAiZGVwZW5kZW5jaWVzIjogewogIH0KfQpQSwECFAAKAAAAAAC5gDJX+1wOvxgFAAAYBQAACAAAAAAAAAAAAAAAAAAAAAAAaW5kZXgudHNQSwECFAAKAAAAAAC5gDJXGlLRCBwAAAAcAAAADAAAAAAAAAAAAAAAAAA+BQAAcGFja2FnZS5qc29uUEsFBgAAAAACAAIAcAAAAIQFAAAAAA=="
                    },
                    "nextAction": {
                      "name": "step_5",
                      "type": "PIECE",
                      "valid": true,
                      "settings": {
                        "input": {
                          "auth": "{{connections['ichiba-pipedrive']}}",
                          "name": "{{step_12['name']}}",
                          "email": "{{step_12['email']}}",
                          "phone": "{{step_12['phone']}}",
                          "source": "Org",
                          "country": "{{step_12['c6e88ba97483902c66ed48f68441a39a8b3305b3_country']}}"
                        },
                        "pieceName": "@tuyendaovan6789/piece-pipedrive",
                        "actionName": "add_person",
                        "inputUiInfo": {},
                        "pieceVersion": "0.3.8"
                      },
                      "displayName": "Add Person"
                    },
                    "displayName": "build payload for add new person"
                  },
                  "displayName": "get country name"
                },
                "onSuccessAction": {
                  "name": "step_8",
                  "type": "CODE",
                  "valid": true,
                  "settings": {
                    "input": {
                      "item": "{{step_2['body']['data']['items'][0]['item']}}"
                    },
                    "inputUiInfo": {},
                    "artifact": "UEsDBAoAAAAAAMKLMlcRB1cTqAAAAKgAAAAIAAAAaW5kZXgudHNleHBvcnQgY29uc3QgY29kZSA9IGFzeW5jIChpbnB1dHMpID0+IHsKICAgIHJldHVybiBgaHR0cHM6Ly9pY2IyLnBpcGVkcml2ZS5jb20vYXBpL3YxL3BlcnNvbnMvJHtpbnB1dHMuaXRlbS5pZH0/YXBpX3Rva2VuPTliY2ExMmEzMTgwZDQ5NjA2N2Q1NDIwNTdhOGM4OGQ5MDdjMThjMDRgOwp9OwpQSwMECgAAAAAAwosyVxpS0QgcAAAAHAAAAAwAAABwYWNrYWdlLmpzb257CiAgImRlcGVuZGVuY2llcyI6IHsKICB9Cn0KUEsBAhQACgAAAAAAwosyVxEHVxOoAAAAqAAAAAgAAAAAAAAAAAAAAAAAAAAAAGluZGV4LnRzUEsBAhQACgAAAAAAwosyVxpS0QgcAAAAHAAAAAwAAAAAAAAAAAAAAAAAzgAAAHBhY2thZ2UuanNvblBLBQYAAAAAAgACAHAAAAAUAQAAAAA="
                  },
                  "nextAction": {
                    "name": "step_9",
                    "type": "PIECE",
                    "valid": true,
                    "settings": {
                      "input": {
                        "url": "{{step_8}}",
                        "method": "GET",
                        "headers": {
                          "Accept": "application/json",
                          "Content-Type": "application/json"
                        },
                        "timeout": "30",
                        "failsafe": false,
                        "queryParams": {}
                      },
                      "pieceName": "@activepieces/piece-http",
                      "actionName": "send_request",
                      "inputUiInfo": {},
                      "pieceVersion": "0.3.5"
                    },
                    "nextAction": {
                      "name": "step_11",
                      "type": "PIECE",
                      "valid": true,
                      "settings": {
                        "input": {
                          "auth": "{{connections['ic-postgres']}}",
                          "query": "SELECT\n    name\nFROM user_management.countries\nwhere code = '{{step_1['country_code']}}' AND sharding_id = '00000000-9999-9999-9999-999999999999'\nLIMIT 1;",
                          "query_timeout": "30000",
                          "application_name": "activepieces - creation person",
                          "connection_timeout_ms": "30000"
                        },
                        "pieceName": "@activepieces/piece-postgres",
                        "actionName": "run-query",
                        "inputUiInfo": {},
                        "pieceVersion": "0.1.0"
                      },
                      "nextAction": {
                        "name": "step_6",
                        "type": "CODE",
                        "valid": true,
                        "settings": {
                          "input": {
                            "new": "{{step_1}}",
                            "old": "{{step_9['body']['data']}}",
                            "country_name": "{{step_11[0]['name']}}"
                          },
                          "inputUiInfo": {},
                          "artifact": "UEsDBAoAAAAAAOSLMldg+vjQWgUAAFoFAAAIAAAAaW5kZXgudHNleHBvcnQgY29uc3QgY29kZSA9IGFzeW5jIChpbnB1dHMpID0+IHsKICAgIGxldCBwaG9uZSA9IGlucHV0cy5vbGQucGhvbmUgfHwgW107CiAgICBsZXQgZmlyc3RfbmFtZSA9IG51bGw7CiAgICBsZXQgbGFzdF9uYW1lID0gbnVsbDsKICAgIGxldCBhY2NvdW50X3R5cGUgPSBpbnB1dHMubmV3LmFjY291bnRfdHlwZSA9PSAxID8gIjI3MiIgOiBpbnB1dHMubmV3LmFjY291bnRfdHlwZSA9PSAyID8gIjI3MSIgOiBudWxsOwogICAgbGV0IGdlbmRlciA9IGlucHV0cy5uZXcuZ2VuZGVyID09IDEgPyAiMjczIiA6IGlucHV0cy5uZXcuZ2VuZGVyID09IDIgPyAiMjc0IiA6IGlucHV0cy5uZXcuZ2VuZGVyID09IDMgPyAiMjc1IiA6IG51bGw7CgogICAgaWYgKGlucHV0cy5uZXcuZnVsbF9uYW1lICE9IG51bGwpIHsKICAgICAgICBmaXJzdF9uYW1lID0gaW5wdXRzLm5ldy5mdWxsX25hbWUuc3BsaXQoJyAnKS5zbGljZSgwLCAtMSkuam9pbignICcpOwogICAgICAgIGxhc3RfbmFtZSA9IGlucHV0cy5uZXcuZnVsbF9uYW1lLnNwbGl0KCcgJykuc2xpY2UoLTEpLmpvaW4oJyAnKTsKICAgIH0KCiAgICBpZiAocGhvbmUubGVuZ3RoID4gMCkgewogICAgICAgIHBob25lID0gcGhvbmUuZmlsdGVyKHggPT4geC52YWx1ZSAhPT0gbnVsbCAmJiB4LnZhbHVlICE9PSAiIik7CiAgICB9CgogICAgaWYgKGlucHV0cy5uZXcucGhvbmVfbnVtYmVyICE9IG51bGwgJiYgIXBob25lLm1hcCh4ID0+IHgudmFsdWUpLmluY2x1ZGVzKGlucHV0cy5uZXcucGhvbmVfbnVtYmVyKSkgewogICAgICAgIHBob25lLnB1c2goe3ZhbHVlOiBpbnB1dHMubmV3LnBob25lX251bWJlcn0pOwogICAgfQoKICAgIC8vIGNvbnN0IHVybCA9IGBodHRwczovL2FwaS5waXBlZHJpdmUuY29tL3YxL3BlcnNvbnMvJHtpbnB1dHMub2xkLmlkfT9hcGlfdG9rZW49OWJjYTEyYTMxODBkNDk2MDY3ZDU0MjA1N2E4Yzg4ZDkwN2MxOGMwNGA7CiAgICAKICAgIHJldHVybiB7CiAgICAgICAgIm5hbWUiOiBpbnB1dHMubmV3LmZ1bGxfbmFtZSwKICAgICAgICAiZmlyc3RfbmFtZSI6IGZpcnN0X25hbWUsCiAgICAgICAgImxhc3RfbmFtZSI6IGxhc3RfbmFtZSwKICAgICAgICAicGhvbmUiOiBwaG9uZSwKICAgICAgICAiYWNjb3VudF90eXBlIjogYWNjb3VudF90eXBlLAogICAgICAgICJiaXJ0aF9kYXkiOiBuZXcgRGF0ZShpbnB1dHMubmV3LmJpcnRoX2RheSksCiAgICAgICAgImdlbmRlciI6IGdlbmRlciwKICAgICAgICAiZmFjZWJvb2tfbGluayI6IGlucHV0cy5uZXcuZmFjZWJvb2tfbGluaywKICAgICAgICAiemFsb19saW5rIjogaW5wdXRzLm5ldy56YWxvX2xpbmssCiAgICAgICAgImNvdW50cnlfbmFtZSI6IGlucHV0cy5jb3VudHJ5X25hbWUKICAgIH07Cn07ClBLAwQKAAAAAADkizJXGlLRCBwAAAAcAAAADAAAAHBhY2thZ2UuanNvbnsKICAiZGVwZW5kZW5jaWVzIjogewogIH0KfQpQSwECFAAKAAAAAADkizJXYPr40FoFAABaBQAACAAAAAAAAAAAAAAAAAAAAAAAaW5kZXgudHNQSwECFAAKAAAAAADkizJXGlLRCBwAAAAcAAAADAAAAAAAAAAAAAAAAACABQAAcGFja2FnZS5qc29uUEsFBgAAAAACAAIAcAAAAMYFAAAAAA=="
                        },
                        "nextAction": {
                          "name": "step_14",
                          "type": "PIECE",
                          "valid": true,
                          "settings": {
                            "input": {
                              "id": "{{step_9['body']['data']['id']}}",
                              "auth": "{{connections['ichiba-pipedrive']}}",
                              "name": "{{step_6['name']}}",
                              "phone": "{{step_6['phone']}}",
                              "gender": "{{step_6['gender']}}",
                              "country": "{{step_6['country_name']}}",
                              "birth_day": "{{step_6['birth_day']}}",
                              "last_name": "{{step_6['last_name']}}",
                              "zalo_link": "{{step_6['zalo_link']}}",
                              "first_name": "{{step_6['first_name']}}",
                              "account_type": "{{step_6['account_type']}}",
                              "facebook_link": "{{step_6['facebook_link']}}"
                            },
                            "pieceName": "@tuyendaovan6789/piece-pipedrive",
                            "actionName": "update_person",
                            "inputUiInfo": {},
                            "pieceVersion": "0.3.8"
                          },
                          "displayName": "Update Person"
                        },
                        "displayName": "build payload for update person"
                      },
                      "displayName": "get country name"
                    },
                    "displayName": "get person detail"
                  },
                  "displayName": "generate url get detail person"
                }
              },
              "displayName": "count person searched"
            },
            "displayName": "search person by email"
          }
        },
        "displayName": "parse value"
      },
      "type": "WEBHOOK",
      "settings": {
        "inputUiInfo": {}
      }
    },
    "valid": true
  }
}